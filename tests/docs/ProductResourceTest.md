# ProductResourceTest テスト概要

このドキュメントでは、`ProductResourceTest` における管理者による商品管理機能のテストケースの目的と検証内容について説明します。

---

## 1. テストの目的

- **商品作成の検証**  
  管理者ユーザーが商品作成ページから新規商品を作成し、その入力値（商品名、価格、在庫数など）が正しくデータベースに反映されることを確認します。

- **商品更新の検証**  
  既存の商品情報を管理者が更新した際、更新後のデータ（商品名、価格、在庫数）がデータベースに正しく反映されることを確認します。

- **商品削除の検証**  
  管理者が商品を削除すると、該当する商品レコードがデータベースから削除され、同時に関連する画像ファイル（例: 商品画像）も削除されることを確認します。

---

## 2. テストケースの詳細

### 2.1 管理者による商品作成 (`test_admin_can_create_product`)
- **目的:**  
  管理者が新規商品作成画面から、正しい情報を入力して商品を作成できることを確認します。

- **実装の流れ:**  
  1. 管理者ユーザー（`admin` ロールを持つユーザー）を作成し、認証状態にします。  
  2. Livewire コンポーネント `CreateProduct` をテストし、フォームの各フィールド（`data.name`, `data.price`, `data.stock`）に入力値をセットします。  
  3. `create` メソッドを呼び出し、商品作成後に `/admin/products` にリダイレクトされるか検証します。  
  4. データベースに対して、作成した商品の情報（名前、価格、在庫数）が正しく保存されていることを確認します。

---

### 2.2 管理者による商品更新 (`test_admin_can_update_product`)
- **目的:**  
  管理者が既存の商品情報（商品名、価格、在庫数）を更新し、その変更がデータベースに正しく反映されることを確認します。

- **実装の流れ:**  
  1. 対象となる商品を、旧商品名、旧価格、旧在庫数でデータベースに登録します。  
  2. 管理者ユーザーを作成し、認証状態にします。  
  3. Livewire コンポーネント `EditProduct` を対象に、`record` として商品の slug を指定し、更新処理を実施します。  
  4. 新しい値（更新後の商品名、価格、在庫数）をセットし、`save` メソッドを呼び出し、更新が成功したことを検証します。  
  5. データベースが更新後の情報を正しく反映していることを確認します。

---

### 2.3 管理者による商品削除 (`test_admin_can_delete_product`)
- **目的:**  
  管理者が商品を削除する処理において、該当商品のレコードがデータベースから削除され、さらに関連する画像ファイル（例: 商品画像）も消去されることを確認します。

- **実装の流れ:**  
  1. `Storage::fake('public')` を利用して、ファイルシステム操作を模擬環境で実行します。  
  2. テスト用の商品画像（例: `products/test.jpg`）をダミーのコンテンツとして保存し、同じ画像パスを持つ商品レコードをデータベースに作成します。  
  3. 管理者ユーザーを作成し、認証状態にします。  
  4. Livewire コンポーネント `ListProducts` を利用して、テーブルアクション `delete` を呼び出し、対象商品を削除します。  
  5. データベースにおいて、該当する商品レコードが存在しないこと（`assertDatabaseMissing`）を検証し、また Storage 上から画像ファイルが削除されていることを確認します。

---

## 3. テスト実施のポイント

- **認証と権限管理:**  
  各テストは管理者ユーザーとして実行されるため、ユーザーのロール（admin ロール）の付与と認証状態がテストの前提条件となっている点に留意します。

- **Livewire コンポーネントの使用:**  
  商品の作成、更新、削除処理は Livewire コンポーネント経由で実装されており、これらのコンポーネントの動作（入力値の設定、メソッドの呼び出し、リダイレクト処理）が正しく行われるかを検証します。

- **Storage のモック:**  
  商品削除テストでは、実際のファイルシステムに影響を与えずにファイル削除処理を検証するため、`Storage::fake` を使用している点が重要です。

---

このテスト計画により、管理者による商品管理操作（作成、更新、削除）の全てが期待通りに動作し、ユーザーインターフェースおよびデータベース、さらにファイルシステムとの連携が正確であることが保証されます。
