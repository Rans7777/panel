# OrderResourceTest テスト概要

このドキュメントでは、`OrderResource` クラスに定義されたプライベートメソッドとナビゲーション登録機能に対するテストケースの目的と検証内容について説明します。

---

## 1. テストの目的

- **オプション情報のフォーマット検証**  
  - **フォーム用のフォーマット (`formatOptionsForForm`)**  
    入力がリスト形式、連想配列形式、または JSON 文字列の場合に、正しい形式の文字列（例: 「Extra Cheese: 1000, Extra Sauce: 500」）に変換されることを確認します。  
    - 無効な JSON 文字列の場合は、元の文字列そのまま返すことを検証。

  - **テーブル用のフォーマット (`formatOptionsForTable`)**  
    オプション名が長い場合、指定された文字数（例: 20 文字）を超える場合は省略記号「…」を付加して短縮表示されること、または連想配列形式でも同様の処理が行われることを確認します。

- **テキスト短縮処理の検証**  
  `shortenText` メソッドが指定した文字数の制限を超えるテキストを短縮し、末尾に「…」を追加する動作を検証します。

- **ナビゲーション登録の検証**  
  - 管理者ユーザーの場合、`shouldRegisterNavigation` が `true` を返し、ナビゲーションにリソースが表示されること。  
  - ゲストユーザーや非管理者ユーザーの場合は、`false` を返すことを確認します。

---

## 2. テストケースの詳細

### 2.1. オプション情報のフォーマット（フォーム用）
- **リスト形式の入力**  
  - **テストケース**: `Format options for form with list input`  
  - **内容**: 配列の形式で、各要素が `['option_name' => '名称', 'price' => 数値]` の形式の場合、正しく「名称: 数値, ...」という文字列にフォーマットされることを確認します。

- **連想配列形式の入力**  
  - **テストケース**: `Format options for form with associative input`  
  - **内容**: 連想配列形式でキーがオプション名、値が価格を含む配列の場合、キーと価格を「キー: 数値, ...」の形式に変換することを確認します。

- **JSON 文字列での入力**  
  - **テストケース**: `Format options for form with JSON string input`  
  - **内容**: JSON 文字列として渡された配列が正しくデコードされ、フォーマットされた文字列に変換されることを確認します。

- **無効な JSON 文字列の場合**  
  - **テストケース**: `Format options for form with invalid JSON string returns original string`  
  - **内容**: 不正な JSON 文字列が入力された場合、変換せずにそのままの文字列が返されることを確認します。

---

### 2.2. オプション情報のフォーマット（テーブル用）
- **リスト形式の入力**  
  - **テストケース**: `Format options for table with list input`  
  - **内容**: オプション名が長い場合、指定された文字数（例: 20文字）を超える場合に、`shortenText` メソッドによる短縮が適用され、複数のオプションが「短縮名, オプション名」の形式で連結されることを確認します。

- **連想配列形式の入力**  
  - **テストケース**: `Format options for table with associative input`  
  - **内容**: 連想配列の場合も、キーが長い場合に短縮され、正しく連結された文字列が生成されることを検証します。

---

### 2.3. テキスト短縮機能
- **テストケース**: `Shorten text method works correctly`  
- **内容**: 指定した文字数制限（例: 10文字）を超えるテキストに対して、末尾に省略記号「…」が付加されるかを検証し、結果の長さが制限内に収まっていることを確認します。

---

### 2.4. ナビゲーション登録機能
- **管理者ユーザーの場合**  
  - **テストケース**: `Navigation registration returns true for admin user`  
  - **内容**: 管理者ロールを持つユーザーでログインした状態で、`shouldRegisterNavigation` が `true` を返すことを検証します。

- **ゲストユーザーの場合**  
  - **テストケース**: `Navigation registration returns false for guest user`  
  - **内容**: 認証されていない状態（ゲスト）で、`shouldRegisterNavigation` が `false` を返すことを確認します。

- **非管理者ユーザーの場合**  
  - **テストケース**: `Navigation registration returns false for non-admin user`  
  - **内容**: ロールが管理者でないユーザーでログインした場合、リソースがナビゲーションに登録されないことを確認します。

---

## 3. テスト実施のポイント

- **プライベートメソッドのテスト**  
  - `invokePrivateStaticMethod` 関数を利用して、`OrderResource` のプライベートメソッドにアクセスし、各フォーマットメソッドとテキスト短縮処理の動作を確認しています。

- **入力形式の多様性**  
  - フォーマットに用いられる入力は、リスト、連想配列、JSON文字列と多様であり、各ケースに対して期待される出力が生成されることをテストすることで、柔軟性と堅牢性を保証しています。

- **ナビゲーション登録**  
  - ユーザーの認証状態とロールに応じて、リソースがナビゲーションに表示されるか（または表示されないか）を確認することで、管理画面での表示制御が正しく行われることを検証しています。

---

このテスト計画により、`OrderResource` のオプション情報のフォーマットとナビゲーション登録が、様々な入力ケースやユーザーの状態に対して正確に実行されることを保証し、ユーザーインターフェイスおよび管理画面の一貫性と堅牢性が確保されます。
