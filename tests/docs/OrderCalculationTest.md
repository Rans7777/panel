# OrderCalculationTest テスト概要

このドキュメントでは、OrderPage クラスにおける合計金額計算とお釣り計算のユニットテストの目的と検証内容について、わかりやすく説明します。

---

## 1. テストの目的

- **合計金額計算 (calculateTotalPrice) の検証**  
  カート内の各商品（価格と数量、場合によってはオプションの追加料金を含む）の合計金額が正確に計算されることを確認する。

- **お釣り計算 (calculateChange) の検証**  
  支払い金額と合計金額に基づいて、適切なお釣り（金額差）を算出できることを確認する。  
  - 支払いが不足している場合は負の値が返されること。  
  - 支払い額が合計と一致する場合は 0 になること。

- **カート再計算の検証**  
  カート内の商品の数量が変更された場合に、合計金額が再計算され適切に更新されることをテストします。

---

## 2. テストケースの詳細

### 2.1. 合計金額の計算 (`calculateTotalPrice`)

- **非空カートの場合**  
  - **内容:** 商品1が 100 円 × 2、商品2が 300 円 × 1 の場合、合計金額が 500 円となることを検証。

- **空のカートの場合**  
  - **内容:** カートが空の場合、合計金額は 0 であることを確認。

- **複数商品の計算**  
  - **内容:** 複数商品の組み合わせ（例：1商品が 150 円 × 1、2商品が 200 円 × 3、3商品が 50 円 × 5）の場合、正しい合計金額（この例では 1000 円）が計算されることを確認。

- **単一商品の計算**  
  - **内容:** 1種類の商品が 50 円 × 4 の場合、合計が 200 円であることを検証。

- **オプション付き商品の計算**  
  - **内容:** 商品にオプション（例：追加料金 50 円）が含まれる場合でも、基本価格と数量に基づいて正しい合計金額（この例では 300 円 × 2 = 600 円）が計算されることを確認。

- **大きな数値の場合**  
  - **内容:** 商品1：9,999,999 円 × 2、商品2：8,888,888 円 × 1 を入力した場合、合計が 28,888,886 円になることを検証。

### 2.2. お釣りの計算 (`calculateChange`)

- **十分な支払いの場合**  
  - **内容:** 合計 500 円に対して支払い 1000 円の場合、お釣りが 500 円となることを検証。

- **支払い不足の場合**  
  - **内容:** 合計 800 円に対して支払い 700 円の場合、結果がお釣り -100 円（不足分）となることを確認。

- **支払いと合計が等しい場合**  
  - **内容:** 合計 300 円に対して支払いが 300 円の場合、差額は 0 になることを確認。

- **支払いなしの場合**  
  - **内容:** 合計 400 円で支払いが 0 円の場合、結果として -400 円が返されることを検証。

### 2.3. カート内容変更後の再計算

- **変更後の計算**  
  - **内容:** 初めに合計金額が 500 円と計算された後、商品の数量を変更し再計算を行い、合計金額が正しく 900 円に更新されることを確認。

---

## 3. テスト実施のポイント

- **プライベートメソッドのテスト:**  
  `calculateTotalPrice` はプライベートメソッドですが、Reflection を用いてテスト内から呼び出し、計算結果 (`totalPrice`) を検証しています。

- **シナリオ別の検証:**  
  異なるカート状態（空、単一、複数、オプション付き、大きな数値）や支払い状況ごとにテストを行い、各シナリオで正しい結果が得られることを確認します。

- **お釣り計算の柔軟性:**  
  支払いが過剰な場合、足りない場合、またはぴったりの場合の違いを検証することで、ユーザーの決済処理が正確に行われるかどうかを確認します。

---

このテスト計画により、OrderPage 内で実施される合計金額計算及びお釣り計算のロジックが、多様なシナリオにおいて正しく動作することを保証します。
