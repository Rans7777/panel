# UserResourceTest テスト概要

このドキュメントでは、管理者ユーザーがユーザーを管理する際の各操作（登録、更新、有効状態の切り替え、削除）に対するテストケースとその目的について説明します。

---

## 1. テストの目的

管理者はシステム内のユーザー情報を適切に管理できる必要があります。  
各テストでは以下の点を検証します:
- **新規ユーザー登録:** 管理者が正しい情報でユーザーを登録できること。
- **既存ユーザーの更新:** ユーザー情報が正しく更新され、データベースに反映されること。
- **ユーザーの有効状態の切り替え:** ユーザーの稼働状態（`is_active`）が適切に反転できること。
- **ユーザー削除:** ユーザーが削除され、データベースから該当レコードが除去されること。

---

## 2. テストケースの詳細

### 2.1. 新規ユーザー登録 (`admin can register a new user`)

- **目的:**  
  管理者が新しいユーザーを登録し、入力された情報がデータベースに正しく保存されることを確認します。

- **テストの流れ:**  
  1. 管理者ユーザー（`admin` ロールを付与されたユーザー）を作成し、認証状態にする。  
  2. `CreateUser` Livewire コンポーネントで、ユーザーの名前、メール、パスワード、有効状態、および所属ロールをセット。  
  3. `create` メソッドを呼び出し、エラーが発生しないことを確認。  
  4. 登録後、データベースに新規ユーザーの情報が正しく保存されているか検証する。

---

### 2.2. 既存ユーザーの更新 (`admin can update an existing user`)

- **目的:**  
  管理者が既存ユーザーの情報（名前、メールアドレス、パスワード、ロール）を更新し、変更内容がデータベースに反映されることを確認します。

- **テストの流れ:**  
  1. 既存のユーザーを作成し、初期の名前とメールアドレスを設定する。  
  2. 管理者ユーザーとして認証し、`EditUser` Livewire コンポーネントを使用して対象ユーザーの情報を更新。  
  3. 設定した新しい情報でデータベースが更新され、エラーが発生しないことを確認する。

---

### 2.3. ユーザーの有効状態の切り替え (`admin can toggle user active status`)

- **目的:**  
  ユーザーの有効状態（`is_active`）を管理者が変更できること、およびその状態が正しく反映されることを確認します。

- **テストの流れ:**  
  1. 有効状態が `true` のユーザーを作成する。  
  2. ユーザーの `is_active` プロパティを反転させる操作を行い、データベース上の状態が更新されることを検証する。

---

### 2.4. ユーザー削除 (`admin can delete a user`)

- **目的:**  
  管理者がユーザーを削除し、そのユーザーのレコードがデータベースから完全に削除されることを確認します。

- **テストの流れ:**  
  1. 管理者ユーザーとして認証状態にし、削除対象のユーザーを作成する。  
  2. 対象ユーザーに対して削除操作を実施する。  
  3. データベースに該当ユーザーのレコードが存在しないことを検証する。

---

## 3. テスト実施のポイント

- **Livewire コンポーネントの利用:**  
  ユーザーの登録および更新は、Livewire コンポーネントを通じて実行され、ユーザー入力のシミュレーションおよびエラーチェックが行われます。

- **データベース検証:**  
  `assertDatabaseHas` と `assertDatabaseMissing` を活用して、各操作後のデータベースの状態が期待通りになっているかを確認します。

- **ロール管理:**  
  テスト前に `admin` ロールが作成され、管理者ユーザーに適切に割り当てられていることが、テスト実行の前提条件となります。

---

このテスト計画により、管理者によるユーザー管理機能が正しく動作し、システム全体で安全かつ一貫したユーザー管理が実現されていることを保証します。
