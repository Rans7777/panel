# ActivityLogs ページのテスト概要

このドキュメントでは、`ActivityLogs` ページに対するテストケースと、その目的・確認項目について説明します。

---

## 1. テストの目的

- **アクセス制御の検証**  
  - 管理者ユーザーのみがページにアクセスできることを確認します。
  - 非管理者ユーザーの場合、警告通知が表示され、適切なリダイレクトが実行されることを確認します。

- **テーブル表示の検証**  
  - アクティビティログ一覧が正しく表示されること（ログレベル、ログ内容、IPアドレス、日時の各カラム）を確認します。
  - テーブルのソート、検索、フィルター機能が想定通りに動作することを検証します。

- **ナビゲーション登録の検証**  
  - `shouldRegisterNavigation` メソッドで、管理者ユーザーの場合にのみページがナビゲーションに表示されることを確認します。

---

## 2. テストケース

### 2.1 アクセス権限テスト

- **管理者ユーザーの場合 (test_admin_user_can_access_activity_logs)**  
  - 管理者ユーザーとしてログインし、`ActivityLogs` ページにアクセス。  
  - ページが正常に表示され、アクティビティログテーブルが正しくレンダリングされることを確認。

- **非管理者ユーザーの場合 (test_non_admin_user_is_redirected_to_admin_page)**  
  - 非管理者ユーザーまたは認証されていないユーザーとしてログインし、ページにアクセス。  
  - 警告通知（例：「アクセス拒否」「管理者権限が必要です。」）が表示され、`/admin/` へリダイレクトされることを確認。

---

### 2.2 テーブル機能テスト

- **テーブルクエリ・ソート**  
  - アクティビティログが `created_at` に基づいて降順（最新のログが最初）に並んでいることを確認します。

- **各カラムの表示**  
  - **ログレベル (`log_name`)**  
    - 各ログエントリのログレベルが「info」「warning」「error」など正しいラベルで表示されるか確認。  
    - 状態に応じたカラー設定（info → primary, warning → warning, error → danger）が適用されることを検証。  
  - **ログ内容 (`description`)**  
    - ログの詳細内容が正しく表示される。  
    - 検索機能が有効になっていることを確認。
  - **IPアドレス (`ip_address`)**  
    - 各ログに対して、`properties` 配列から `ip_address` を正しく取得し、表示しているかを確認。  
    - 該当するキーが存在しない場合は `'N/A'` と表示されることを検証し、IPアドレスでの検索機能もチェック。
  - **日時 (`created_at`)**  
    - 日付が `Y年m月d日 H:i:s` フォーマットで表示されること、またソートが正しく機能することを確認。

- **テーブルフィルター機能**  
  - **ログレベルフィルター**  
    - ドロップダウンからログレベルを選択し、対象のログのみが抽出されるかを確認。
  - **作成日時フィルター**  
    - `開始日時` と `終了日時` を設定し、指定期間内のログが正しくフィルタリングされるかを検証。

---

### 2.3 ナビゲーション登録テスト

- **shouldRegisterNavigation メソッド**  
  - 管理者ユーザーの場合、メソッドが `true` を返し、ナビゲーションにページが表示されることを確認。  
  - 非認証または管理者ではないユーザーの場合、メソッドが `false` を返す、またはページがナビゲーションに表示されないことを確認。

---

## 3. テストの実施方法

- **PHPUnit** や **Feature Test** を使用して、上記の各ケースを自動テストで検証します。  
- テスト内でフィクスチャやモックを用い、ユーザーのロールやアクセス権限、データベースの状態をシミュレートして確認します。
- 特に、非管理者ユーザー時のレスポンス（警告通知およびリダイレクト挙動）については、HTTP レスポンスを直接検査することで精度を高めます。

---

## 4. まとめ

このテスト計画により、`ActivityLogs` ページが以下の点で正常に動作していることを確認します：

- 管理者専用のアクセス制御およびナビゲーション表示
- アクティビティログテーブルの正確な表示（内容、並び順、検索・フィルター機能）
- ユーザー体験に関わる通知やリダイレクトの適切な処理

各テストケースを実施することで、将来的な変更が予期せぬ動作を引き起こさないよう、システムの品質を維持するための堅牢なテスト基盤を確立します。
