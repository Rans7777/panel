# SalesOverviewTest テスト概要

このテストでは、管理画面で表示される「SalesOverview」ウィジェットの動作が正しく行われているかを検証しています。主に、ウィジェットが各期間（例：「今日」など）の売上データを正しく集計し、カードとして表示していることを確認します。

---

## 1. テストの目的

- **ウィジェットの表示権限の確認:**  
  管理者ユーザーがウィジェットを表示できるかを、`SalesOverview::canView()` で確認します。

- **売上カードの生成確認:**  
  ウィジェット内部で、非公開メソッド `getCards` を使用して売上情報をカード形式に変換する処理が正しく実装されているかを検証します。
  - 売上カードの件数が想定通り（このテストでは 3 枚）生成されること。
  
- **カード内容の検証:**  
  作成されたカードの内容が正しいかを、リフレクションを用いてプロパティ `label` および `value` を取得することで確認します。
  - 今日の売上カードの `label` が「今日の売上」となっているか。
  - 今日の売上カードの `value` が、今日の注文の合計金額（ここでは¥2,000）として正しい表記になっているか。

---

## 2. テストシナリオの詳細

1. **テスト日時の固定:**  
   テストの開始時に、Carbon を用いて日時を `2023/10/10 12:00:00` に固定しています。  
   これにより、注文の作成日時が意図した期間に属するかを明確に確認できます。

2. **テストデータの作成:**  
   - 管理者ロールを持つユーザーを作成し、認証状態に設定。
   - 3 件の注文データを作成：
     - **今日の注文:** `total_price = 2000`、作成日時は固定日時 (`now`)。
     - **昨日の注文:** `total_price = 1000`、作成日時は `now` の1日前。
     - **2日前の注文:** `total_price = 500`、作成日時は `now` の2日前。

3. **ウィジェットの表示確認:**  
   - `SalesOverview::canView()` により、ウィジェットが問題なく表示可能な状態であることを確認。

4. **カードの生成と検証:**  
   - SalesOverview ウィジェットの非公開メソッド `getCards` をリフレクションを用いて呼び出し、カードの配列を取得。
   - カードの枚数が 3 枚であることを確認。
   - 1枚目のカード（今日の売上カード）に対して：
     - プロパティ `label` が「今日の売上」であることを確認。
     - プロパティ `value` の HTML 表現が、今日の合計売上金額 2000 円を適切な通貨形式（例: `¥2,000`）で返していることを検証。

5. **テスト後のクリーンアップ:**  
   - Carbon のテスト用日時設定をリセットして、他のテストに影響が及ばないようにしています。

---

## 3. テスト実施上の注意点

- **リフレクションの利用:**  
  `getCards` は非公開メソッドおよびカードオブジェクトのプロパティも非公開のため、リフレクションを使用して内部の状態と出力の検証を行っています。

- **日時の設定:**  
  テスト時に日時を固定することで、注文の作成日時に依存した処理が安定して検証できるよう配慮しています。

- **国際化 (I18n):**  
  売上金額の表示は、日本円の通貨形式であることを確認しており、数値のフォーマットに注意が払われています。

---

このテストにより、SalesOverview ウィジェットが管理者に対して正確な売上データをカード形式で表示する仕組みが正しく実装されていることを確認できます。
